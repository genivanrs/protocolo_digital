<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Protocolo Digital</title>

<style>
body {
  font-family: Arial, sans-serif;
  padding: 15px;
  background: #f5f5f5;
}
h2 {
  text-align: center;
}
input, textarea, button {
  width: 100%;
  margin: 6px 0;
  padding: 10px;
  font-size: 15px;
}
textarea {
  resize: vertical;
}
canvas {
  border: 1px solid #000;
  width: 100%;
  height: 160px;
  background: #fff;
}
button {
  background: #1e88e5;
  color: #fff;
  border: none;
  font-size: 16px;
  cursor: pointer;
}
button.secundario {
  background: #777;
}
</style>
</head>

<body>

<h2>üìò Protocolo Digital</h2>

<input id="entregue" placeholder="Entregue por">
<input id="documento" placeholder="Documento (CPF / RG / CNPJ)">
<input id="recebido" placeholder="Recebido por">
<textarea id="descricao" placeholder="Descri√ß√£o do item / servi√ßo"></textarea>
<textarea id="obs" placeholder="Observa√ß√µes"></textarea>

<p><strong>‚úçÔ∏è Assinatura</strong></p>
<canvas id="canvas" width="320" height="160"></canvas>

<button class="secundario" onclick="limpar()">Limpar assinatura</button>
<button onclick="enviar()">Salvar Protocolo</button>

<script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
let desenhando = false;

// Eventos touch (celular)
canvas.addEventListener("touchstart", (e) => {
  desenhando = true;
  ctx.beginPath();
});

canvas.addEventListener("touchend", () => {
  desenhando = false;
});

canvas.addEventListener("touchmove", (e) => {
  if (!desenhando) return;
  e.preventDefault();
  const rect = canvas.getBoundingClientRect();
  const touch = e.touches[0];
  ctx.lineWidth = 2;
  ctx.lineCap = "round";
  ctx.lineTo(touch.clientX - rect.left, touch.clientY - rect.top);
  ctx.stroke();
});

// Limpar assinatura
function limpar() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
}

// Enviar dados
function enviar() {
  if (!entregue.value || !recebido.value || !descricao.value) {
    alert("‚ö†Ô∏è Preencha os campos obrigat√≥rios");
    return;
  }

  const dados = {
    entregue: entregue.value,
    documento: documento.value,
    recebido: recebido.value,
    descricao: descricao.value,
    obs: obs.value,
    assinatura: canvas.toDataURL("image/png")
  };

  fetch("https://script.google.com/macros/s/AKfycbzaKbUZnLQVW_Z-vV4UhnPYqRAMHDp38Hm3nnZeUoKzGUIsoJjQHzyGkiNBs7jIpQCe-A/exec", {
  method: "POST",
  headers: {
    "Content-Type": "application/json"
    },
    body: JSON.stringify({
        nome,
        documento,
        descricao,
        assinatura
    })
    })
    .then(res => res.json())
    .then(resp => {
    if (resp.status === "ok") {
        alert("‚úÖ Protocolo salvo com sucesso!");
    } else {
        alert("‚ùå Erro: " + resp.msg);
    }
    })
    .catch(err => {
    alert("‚ùå Erro de conex√£o");
    console.error(err);
    });



}
</script>

</body>
</html>
